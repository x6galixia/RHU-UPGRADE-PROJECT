<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/css/global/general.css" />
  <link rel="stylesheet" href="/css/local/patient-history.css" />
  <script src="/js/global/logout.js"></script>
  <script src="/js/global/notif.js"></script>
  <script src="/js/global/time.js"></script>
  <title>HealthSync</title>
  <link rel="shortcut icon" type="image/png" href="/img/global/healthvector.png" />
</head>

<body>
  <%- include("../includes/header.ejs") %>
    <main>
      <h1 class="headings">PATIENT HISTORY</h1>
      <div class="health-btn-div">
        <button class="health-btn">HEALTH ASSESMENT</button>
      </div>
      <div class="history-container">
        <% Object.keys(groupedHistory).forEach(year=> { %>
          <div class="year-container">
            <h2>
              <%= year %>
            </h2>
            <ul>
              <% groupedHistory[year].forEach(date=> { %>
                <li>
                  <button class="date-button button-green" data-date="<%= date.toISOString().split('T')[0] %>">
                    <%= new Date(date).toLocaleDateString("en-US", { year: 'numeric' , month: 'long' , day: 'numeric' })
                      %>
                  </button>
                </li>
                <% }) %>
            </ul>
          </div>
          <% }) %>
            <div class="b info-container">
              <!-- Patient information -->
              <h1 class="form-header">PATIENT INFORMATION</h1>
              <div class="patient-info">
                <div class="inputs">
                  <label for="">Name:</label>
                  <input type="text"
                    value="<%= patientHistory.first_name %> <%= patientHistory.middle_name %> <%= patientHistory.last_name %>">
                </div>
                <div class="inputs">
                  <label for="">Philhealth No:</label>
                  <input type="text" value="<%= patientHistory.philhealth_no %>">
                </div>
                <div class="inputs">
                  <label for="">Suffix:</label>
                  <input type="text" value="<%= patientHistory.suffix %>">
                </div>
                <div class="inputs">
                  <label for="">Mobile No.</label>
                  <input type="text" value="<%= patientHistory.phone %>">
                </div>
                <div class="inputs">
                  <label for="">Birthdate:</label>
                  <input type="date" value="<%= patientHistory.birthdate %>">
                </div>
                <div class="inputs">
                  <label for="">Email:</label>
                  <input type="text" value="<%= patientHistory.email %>">
                </div>
                <div class="inputs">
                  <label for="">Gender:</label>
                  <input type="text" value="<%= patientHistory.gender %>">
                </div>
                <div class="inputs">
                  <label for="">Occupation:</label>
                  <input type="text" value="<%= patientHistory.occupation %>">
                </div>
                <div class="inputs">
                  <label for="">Guardian:</label>
                  <input type="text" value="<%= patientHistory.guardian%>">
                </div>
                <div class="inputs">
                  <label for="">Address:</label>
                  <input type="text"
                    value="<%= patientHistory.house_no %> <%= patientHistory.street %> <%= patientHistory.barangay %> <%= patientHistory.city %> <%= patientHistory.province %>">
                </div>
              </div>

              <!-- Medical records -->
              <h1 class="form-header m">MEDICAL RECORDS</h1>
              <div class="patient-info">
                <div class="inputs">
                  <label for="">Height:</label>
                  <input type="number" value="<%= patientHistory.height %>">
                </div>
                <div class="inputs">
                  <label for="">Temperature:</label>
                  <input type="text" value="<%= patientHistory.temperature %>">
                </div>
                <div class="inputs">
                  <label for="">Weight:</label>
                  <input type="text" value="<%= patientHistory.weight %>">
                </div>
                <div class="inputs">
                  <label for="">Heart Rate:</label>
                  <input type="text" value="<%= patientHistory.heart_rate %>">
                </div>
                <div class="inputs">
                  <label for="">Systolic:</label>
                  <input type="text" value="<%= patientHistory.systolic %>">
                </div>
                <div class="inputs">
                  <label for="">Diastolic:</label>
                  <input type="text" value="<%= patientHistory.diastolic %>">
                </div>
                <div class="inputs">
                  <label for="">BMI:</label>
                  <input type="text" value="<%= patientHistory.bmi %>">
                </div>
                <div class="inputs">
                  <label for="">Respiratory Rate:</label>
                  <input type="text" value="<%= patientHistory.respiratory_rate%>">
                </div>
                <div class="wide-inputs">
                  <label for="">Comment:</label>
                  <Textarea><%= patientHistory.comment%></Textarea>
                </div>
              </div>

              <!-- laboratories -->
              <h1 class="form-header m">Laboratories </h1>
              <div class="patient-info">
                <div class="listing">
                  <p>Categories</p>
                  <ul>
                    <li>Blood Gasses</li>
                  </ul>
                </div>
                <div class="listing">
                  <p>Services</p>
                  <ul>
                    <li>Oxygen(02)</li>
                  </ul>
                </div>
                <div class="listing ">
                  <p>Lab. Result</p>
                  <ul>
                    <li>Lab result image</li>
                  </ul>
                </div>
              </div>

              <!-- Prescriptions -->
              <h1 class="form-header m">Prescriptions</h1>
              <div class="patient-info">
                <div class="inputs">
                  <label for="">Height:</label>
                  <input type="number">
                </div>
                <div class="inputs">
                  <label for="">Temperature:</label>
                  <input type="text">
                </div>
              </div>

              <div class="m patient-info">
                <div class="listing">
                  <p><u>Medicines</u></p>
                  <ul>
                    <li>Paracetamol</li>
                  </ul>
                </div>
                <div class="listing">
                  <p><u>Quantity</u></p>
                  <ul>
                    <li>5</li>
                  </ul>
                </div>
                <div class="listing ">
                  <p><u>Instruction</u></p>
                  <ul>
                    <li>2 tabs a day until okay, mwah</li>
                  </ul>
                </div>
              </div>


              <!-- End of info-container-->
            </div>

            <!-- end of history container -->
      </div>
    </main>
    <!-- <script>
      document.querySelectorAll('.date-button').forEach(button => {
        button.addEventListener('click', async (event) => {
          const selectedDate = event.target.getAttribute('data-date');

          try {
            const response = await fetch(`/patient-history/${patient_id}`, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({ date: selectedDate }),
            });

            if (!response.ok) throw new Error('Network response was not ok');

            const patientHistory = await response.json();
            displayPatientHistory(patientHistory);
          } catch (error) {
            console.error('Error fetching patient history:', error);
          }
        });
      });

      function displayPatientHistory(history) {
        const infoContainer = document.querySelector('.info-container');
        infoContainer.innerHTML = ''; // Clear previous information

        if (history.length === 0) {
          infoContainer.innerHTML = '<p>No records found for this date.</p>';
          return;
        }

        history.forEach(record => {
          const recordDiv = document.createElement('div');
          recordDiv.innerHTML = `
            <h2>${record.check_date}</h2>
            <p><strong>Name:</strong> ${record.first_name} ${record.last_name}</p>
            <p><strong>Lab Results:</strong> ${record.lab_results}</p>
            <p><strong>Medicines:</strong> ${record.medicines}</p>
            <p><strong>Instructions:</strong> ${record.instruction}</p>
            <p><strong>Categories:</strong> ${record.categories}</p>
            <p><strong>Services:</strong> ${record.services}</p>
            <hr>
          `;
          infoContainer.appendChild(recordDiv);
        });
      }
    </script> -->
</body>

</html>